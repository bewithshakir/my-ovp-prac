{"version":3,"sources":["ovpApp/rdvr/disk-usage-datasource.js"],"names":[],"mappings":"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","file":"ovpApp/rdvr/disk-usage-datasource.js","sourcesContent":["(function () {\n    'use strict';\n\n    angular\n        .module('ovpApp.rdvr.datasource')\n        .factory('DiskUsageDatasource', factory);\n\n    /* @ngInject */\n    function factory(AbstractDatasource, $q, rx, rxhttp, config, rdvrCacheService, recordingsListType) {\n        return class DiskUsageDatasource extends AbstractDatasource {\n            constructor(stb) {\n                super(stb, recordingsListType.DISK_USAGE, {\n                    data: {usedPercentage: 0, freePercentage: 100}\n                });\n\n                if (this.stb && this.stb.dvr) {\n                    this.source = this.reset.map(() => true)\n                        .startWith(false)\n                        .flatMapLatest(force => {\n                            return this.fetch(force)\n                                .startWith(this.initialValue)\n                                .takeUntil(this.reset);\n                        })\n                        .do(result => this.saveToCache(result))\n                        .map(result => this.convertResultBeforeEmitting(result))\n                        .shareReplay(1);\n                } else {\n                    this.source = rx.Observable.never();\n                }\n            }\n\n            fetch(force) {\n                if (force) {\n                    this.clearCache();\n                }\n\n                // There's only ever one batch for disk usage, but it's still worth reusing the caching logic\n                return this.batchGetWithCache({\n                        getter: this.getOneDiskUsageBatch.bind(this)\n                    })\n                    .catch(e => {\n                        return rx.Observable.just({\n                            data: {usedPercentage: 0, freePercentage: 100},\n                            error: e\n                        });\n                    });\n            }\n\n            getOneDiskUsageBatch() {\n                const baseUrl = config.piHost + config.nrsApi + this.getDvrBase();\n                const fullUrl = baseUrl + this.stb.macAddressNormalized + config.services.dvrDiskUsage;\n                return rxhttp.get(fullUrl, {withCredentials: true})\n                    .retry(2);\n            }\n        };\n    }\n})();\n"],"sourceRoot":"/source/"}