{"version":3,"sources":["ovpApp/services/stb-purchase-pin-factory.js"],"names":[],"mappings":"AAAA;;AAEA,IAAI,eAAe,CAAC,YAAY,EAAE,SAAS,iBAAiB,QAAQ,OAAO,EAAE,KAAK,IAAI,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK,EAAE,IAAI,aAAa,MAAM,IAAI,WAAW,aAAa,WAAW,cAAc,OAAO,WAAW,eAAe,MAAM,IAAI,WAAW,YAAY,WAAW,WAAW,MAAM,OAAO,eAAe,QAAQ,WAAW,KAAK,iBAAiB,OAAO,UAAU,aAAa,YAAY,aAAa,EAAE,IAAI,YAAY,iBAAiB,YAAY,WAAW,aAAa,IAAI,aAAa,iBAAiB,aAAa,cAAc,OAAO;;AAEjiB,SAAS,gBAAgB,UAAU,aAAa,EAAE,IAAI,EAAE,oBAAoB,cAAc,EAAE,MAAM,IAAI,UAAU;;AAJ/G,CAAA,YAAY;IACT;;;IAEA,QAAQ,OAAO,kCAAkC,CAC7C,iBACA,8BACA,sCACA,4CAEH,QAAQ,yBAAyB;;;IAGlC,SAAS,sBAAsB,oBAAoB,IAAI,yBAAyB;;;;;;QAM5E,IADM,iBAAc,CAAA,YAAA;YACL,SADT,eACU,KAAK;gBAEb,gBAAgB,MAHlB;;gBAEE,KAAK,MAAM;;;;;YAQf,aAVE,gBAAc,CAAA;gBAWZ,KAAK;gBACL,OANI,SAAA,WAAG;oBACP,OAAO,mBAAmB,UAAU,KAAK,KAAK,KAAK,UAAA,QAAU;wBACzD,OAAQ,OAAO,cAAe,OAAO;;;;;eAW1C;gBACC,KAAK;gBACL,OARY,SAAA,mBAAG;oBACf,OAAO,wBAAwB;;;;;;;;eAgBhC;gBACC,KAAK;gBACL,OAVa,SAAA,oBAAG;oBAChB,OAAO,GAAG,QAAQ;;;;eAcnB;gBACC,KAAK;gBACL,OAZgC,SAAA,uCAAG;oBACnC,MAAM,IAAI,MAAM;;;;eAgBjB;gBACC,KAAK;gBACL,OAdE,SAAA,OAAC,qBAAqB;oBAepB,IAAI,QAAQ;;;oBAbhB,OAAO,mBAAmB,UAAU,KAAK,KAAK,KAAK,UAAA,QAAU;wBACzD,IAAI,UAAU;4BACV,aAAa;4BACb,cAAc,OAAO;;wBAEzB,OAAO,cAAc;wBACrB,OAAO,mBAAmB,UAAU,MAAK,KAAK;;;;;eAqBnD;gBACC,KAAK;gBACL,OAlBO,SAAA,YAAC,KAAK;;oBAEb,OAAO,mBAAmB,UAAU,KAAK,KAAK,KAAK,UAAA,QAAU;wBACzD,IAAI,OAAO,gBAAgB,KAAK;4BAC5B,OAAO;+BACJ;4BACH,OAAO,GAAG,OAAO;;;;;;YAwB7B,OA3EE;;;QAyDN,OAAO;YACH,QAAQ,SAAA,OAAU,KAAK;gBACnB,OAAO,IAAI,eAAe;;;;KAIrC","file":"ovpApp/services/stb-purchase-pin-factory.js","sourcesContent":["(function () {\n    'use strict';\n\n    angular.module('ovpApp.services.stbPurchasePin', [\n        'ovpApp.config',\n        'ovpApp.services.stbService',\n        'ovpApp.services.stbSettingsService',\n        'ovpApp.services.parentalControlsService'\n    ])\n    .factory('StbPurchasePinFactory', StbPurchasePinFactory);\n\n    /* ngInject */\n    function StbPurchasePinFactory(StbSettingsService, $q, parentalControlsService) {\n\n        /**\n         * Captures the stb and allowing the pin-dialogs to use the set top box defined at navigation.\n         */\n        class StbPurchasePin {\n            constructor(stb) {\n                this.stb = stb;\n            }\n\n            /* used as pinService */\n            isPINSet() {\n                return StbSettingsService.getDevice(this.stb).then(device => {\n                    return (device.purchasePIN) ? true : false;\n                });\n            }\n\n            /* pinService interface */\n            isPrimaryAccount() {\n                return parentalControlsService.isPrimaryAccount();\n            }\n\n            /**\n             * pinService interface - used by pin-entry.js\n             *\n             * The should always return false since it has no meaning in this context\n             */\n            shouldSetDefaults() {\n                return $q.resolve(false);\n            }\n\n            /* pinService interface */\n            setPINForFirstTimeWithDefaultRatings() {\n                throw new Error('setPINForFirstTimeWithDefaultRatings should never be called in StbSettingsService');\n            }\n\n            /* pinService interface */\n            setPIN(pin /*, password */) {\n                //TODO Use password if this is not the primary account\n                return StbSettingsService.getDevice(this.stb).then(device => {\n                    var devData = {\n                        purchasePIN: pin,\n                        strTimestamp: device.strTimestamp\n                    };\n                    device.purchasePIN = pin;\n                    return StbSettingsService.setDevice(this.stb, devData);\n                });\n            }\n\n            /* pinService interface */\n            validatePIN(pin) {\n\n                return StbSettingsService.getDevice(this.stb).then(device => {\n                    if (device.purchasePIN === pin) {\n                        return true;\n                    } else {\n                        return $q.reject('Invalid pin');\n                    }\n                });\n            }\n        }\n\n        return {\n            create: function (stb) {\n                return new StbPurchasePin(stb);\n            }\n        };\n    }\n}());\n"],"sourceRoot":"/source/"}