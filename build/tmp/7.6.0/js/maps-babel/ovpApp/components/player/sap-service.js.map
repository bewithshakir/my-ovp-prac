{"version":3,"sources":["ovpApp/components/player/sap-service.js"],"names":[],"mappings":"AAAA;;AAAC,CAAA,YAAY;IACT;;;IAEA,QACK,OAAO,4BAA4B,CAAC,OACpC,QAAQ,cAAc;;;IAG3B,SAAS,WAAW,IAAI,YAAY,YAAY,aAAa;QACzD,IAAM,MAAM,IAAI;;QAEhB,IAAM,eAAe;YACjB,WAAW;YACX,SAAS;;;QAGb,IAAM,UAAU;YACZ,YAAA;;;QAGJ,OAAO;;;;QAIP,SAAS,WAAW,QAAQ;YACxB,IAAI,WAAW,IAAI,IAAI;YACvB,IAAI,CAAC,UAAU;gBACX,WAAW,KAAK;gBAChB,IAAI,IAAI,QAAQ;;YAEpB,OAAO;;;QAGX,SAAS,KAAK,QAAQ;YAClB,IAAM,UAAU,IAAI,GAAG,gBAAgB;;YAEvC,WAAW,IAAI,aAAa,YAAM;gBAC9B,QAAQ,OAAO;;YAEnB,OAAO,GAAG,YAAY,UAAA,KAAO;gBACzB,IAAI,IAAI,MAAM,SAAS,GAAG;oBACtB,QAAQ,OAAO;wBACX,WAAW;wBACX,SAAS,CAAC,CAAC,WAAW,QAAQ,YAAY;;uBAE3C;oBACH,QAAQ,OAAO;;;;YAIvB,OAAO;gBACH,QAAQ,QAAQ,eAAe;gBAC/B,QAAQ,SAAA,SAAY;oBAChB,IAAM,eAAe,QAAQ;oBAC7B,IAAM,aAAa,CAAC,aAAa;oBACjC,WAAW,QAAQ,YAAY,YAAY;oBAC3C,OAAO,cAAc;;oBAErB,QAAQ,OACJ,QAAQ,OAAO,IAAI,cAAc,EAAC,SAAS;;;oBAI/C,KAAK,WAAW,MAAM,oBAAoB;wBACtC,eAAe;wBACf,aAAa;wBACb,yBAAyB;wBACzB,iBAAiB;;;;;;KAOpC","file":"ovpApp/components/player/sap-service.js","sourcesContent":["(function () {\n    'use strict';\n\n    angular\n        .module('ovpApp.player.sapService', ['rx'])\n        .factory('sapService', sapService);\n\n    /** @ngInject */\n    function sapService(rx, $rootScope, ovpStorage, storageKeys) {\n        const map = new Map();\n\n        const notAvailable = {\n            available: false,\n            enabled: false\n        };\n\n        const service = {\n            withPlayer\n        };\n\n        return service;\n\n        ///////////\n\n        function withPlayer(player) {\n            let sapState = map.get(player);\n            if (!sapState) {\n                sapState = init(player);\n                map.set(player, sapState);\n            }\n            return sapState;\n        }\n\n        function init(player) {\n            const subject = new rx.BehaviorSubject(notAvailable);\n\n            $rootScope.$on('sap-reset', () => {\n                subject.onNext(notAvailable);\n            });\n            player.on('sap-init', val => {\n                if (val.audio.length > 1) {\n                    subject.onNext({\n                        available: true,\n                        enabled: !!ovpStorage.getItem(storageKeys.sapEnabled)\n                    });\n                } else {\n                    subject.onNext(notAvailable);\n                }\n            });\n\n            return {\n                stream: subject.asObservable().distinctUntilChanged(),\n                toggle: function () {\n                    const currentState = subject.getValue();\n                    const newEnabled = !currentState.enabled;\n                    ovpStorage.setItem(storageKeys.sapEnabled, newEnabled);\n                    player.setSAPEnabled(newEnabled);\n\n                    subject.onNext(\n                        angular.extend({}, currentState, {enabled: newEnabled})\n                    );\n\n                    // Analytics:\n                    this.$rootScope.$emit('Analytics:select', {\n                        operationType: 'sapToggle',\n                        toggleState: newEnabled,\n                        elementStandardizedName: 'sapToggle',\n                        pageSectionName: 'DeriveFromOpType'\n                    });\n\n                }\n            };\n        }\n    }\n}());\n"],"sourceRoot":"/source/"}