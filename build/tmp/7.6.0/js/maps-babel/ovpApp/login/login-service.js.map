{"version":3,"sources":["ovpApp/login/login-service.js"],"names":[],"mappings":"AAAA;;AAAA,CAAC,YAAY;IACT;;;IAEA,QAAQ,OAAO,6BAA6B,CACxC,iBACA,8BACA,gBACA,mBACA,2BACA,+BAEH,QAAQ,gBAAgB;;;IAGzB,SAAS,aAAa,QAAQ,YAAY,aAAa,IAAI,cACxD,iBAAiB,UAAU,OAAO,YAAY,mBAAmB;;QAEhE,IAAI,gBAAa;YAAE,mBAAgB;;QAEnC,IAAM,UAAU;YACZ,OAAA;YACA,cAAA;YACA,oCAAA;YACA,+BAAA;YACA,uBAAA;YACA,kBAAA;YACA,YAAA;;;QAGJ,OAAO;;;;;;QAMP,SAAS,MAAM,UAAU;YACrB,gBAAgB;;;QAGpB,SAAS,YAAY,SAAS;YAC1B,cAAc;;;;;;;;;;QAUlB,SAAS,aAAa,UAAU,UAAU,kBAAkB;YACxD,IAAI,iBAAiB,mBAAmB,WAAW;;YAEnD,OAAO,aAAa,UAAU,UAAU,UACnC,KAAK,YAAY;gBACd,WAAW;gBACX,WAAW,MAAM,+BAA+B,EAAC,WAAW;eAC7D,UAAU,OAAO;;gBAEhB,IAAI,MAAM,WAAW;oBACjB,MAAM,YAAY;oBAClB,MAAM,cAAc;oBACpB,WAAW,MAAM,+BAA+B;oBAChD,OAAO,GAAG,OAAO;uBACd;oBACH,WAAW,MAAM,+BACb,EAAC,WAAW,OAAO,aAAa;oBACpC,aAAa;wBACT,kBAAkB;wBAClB,KAAK,MAAM;wBACX,MAAM;wBACN,KAAK,MAAM;wBACX,OAAO,MAAM;;oBAEjB,OAAO,GAAG;;;;;QAK1B,SAAS,qCAAqC;YAC1C,IAAI,oBAAoB,WAAW,QAAQ,YAAY;YACvD,mBAAmB,oBAAoB;YACvC,OAAO,GAAG,QAAQ,qBAAqB;;;QAG3C,SAAS,wBAAwB;YAC7B,OAAO,WAAW,QAAQ,YAAY,wBAAwB;;;QAGlE,SAAS,mBAAmB;YACxB,WAAW,QAAQ,YAAY,oBAAoB;;;QAGvD,SAAS,gCAAgC;YACrC,WAAW,QAAQ,YAAY,0BAA0B;;;;;;;;QAQ7D,SAAS,WAAW,UAAU;YAC1B,IAAI,iBAAiB;gBACjB,UAAU;gBACV,IAAI;gBACJ,eAAe;gBACf,aAAa;gBACb,cAAc;;;YAGlB,WAAW,QAAQ,YAAY,iBAAiB;;;;;;;;;QASpD,SAAS,aAAa,SAAS;YAC3B,IAAI,UAAU,kBAAkB,kBAAkB;;YAElD,aAAa;;YAEb,IAAI,CAAC,QAAQ,iBAAiB;gBAC1B,MAAM,KAAK;oBACP,SAAS;oBACT,YAAY;;gBAEhB,YAAY;;;;KAIvB","file":"ovpApp/login/login-service.js","sourcesContent":["(function () {\n    'use strict';\n\n    angular.module('ovpApp.login.loginService', [\n        'ovpApp.config',\n        'ovpApp.services.ovpStorage',\n        'ovpApp.oauth',\n        'ovpApp.messages',\n        'ovpApp.components.alert',\n        'ovpApp.services.errorCodes'\n    ])\n    .service('loginService', loginService);\n\n    /* @ngInject */\n    function loginService(config, ovpStorage, storageKeys, $q, OauthService,\n       locationService, messages, alert, $rootScope, errorCodesService) {\n\n        let errorCallBack, parentalControls;\n\n        const service = {\n            error,\n            authenticate,\n            hasAcceptedParentalControlsWarning,\n            acceptParentalControlsWarning,\n            hasAcceptedSpecUTerms,\n            acceptSpecUTerms,\n            rememberMe\n        };\n\n        return service;\n\n        /**\n         * Error function\n         * @param callback\n         */\n        function error(callback) {\n            errorCallBack = callback;\n        }\n\n        function reportError(message) {\n            errorCallBack(message);\n        }\n\n        /**\n         * Authenticate user\n         *\n         * @param {String} username Username\n         * @param {String} password Password\n         * @param {Boolean} rememberMeCookie true if user should be remembered next visit\n         */\n        function authenticate(username, password, rememberMeCookie) {\n            var rememberedUser = rememberMeCookie ? username : '';\n\n            return OauthService.userLogin(username, password)\n                .then(function () {\n                    rememberMe(rememberedUser);\n                    $rootScope.$emit('Session:loginActionComplete', {isSuccess: true});\n                }, function (error) {\n                    // invalid creds\n                    if (error.errorCode) {\n                        error.isSuccess = false;\n                        error.failureType = 'userAuthenticationError';\n                        $rootScope.$emit('Session:loginActionComplete', error);\n                        return $q.reject(error);\n                    } else {\n                        $rootScope.$emit('Session:loginActionComplete',\n                            {isSuccess: false, failureType: 'serviceError'});\n                        serviceError({\n                            impactedFunction: 'authenticate',\n                            url: error.url,\n                            data: 'NA',\n                            xhr: error.xhr,\n                            error: error.error\n                        });\n                        return $q.reject();\n                    }\n                });\n        }\n\n        function hasAcceptedParentalControlsWarning() {\n            let persistedControls = ovpStorage.getItem(storageKeys.parentalControlsAccepted);\n            parentalControls = parentalControls || persistedControls;\n            return $q.resolve(parentalControls !== undefined);\n        }\n\n        function hasAcceptedSpecUTerms() {\n            return ovpStorage.getItem(storageKeys.specuTermsAccepted) === true;\n        }\n\n        function acceptSpecUTerms() {\n            ovpStorage.setItem(storageKeys.specuTermsAccepted, true);\n        }\n\n        function acceptParentalControlsWarning() {\n            ovpStorage.setItem(storageKeys.parentalControlsAccepted, true);\n        }\n\n        /**\n         * sets loginRememberMe for home page in local storage\n         *\n         * @param {String} username username\n         */\n        function rememberMe(username) {\n            var rememberMeJson = {\n                username: username,\n                cc: true,\n                last_activity: '',\n                last_action: '',\n                last_channel: ''\n            };\n\n            ovpStorage.setItem(storageKeys.loginRememberMe, rememberMeJson);\n        }\n\n        /*\n         * Report service error to event gateway\n         *\n         * @param {Object} AJAX options+.  Include impactedFunction for event gateway and\n         * suppressMessage option to prevent message being displayed to user.\n         */\n        function serviceError(options) {\n            var message = errorCodesService.getMessageForCode('WGE-1001');\n\n            OauthService.reset();\n\n            if (!options.suppressMessage) {\n                alert.open({\n                    message: message,\n                    buttonText: 'OK'\n                });\n                reportError(message);\n            }\n        }\n    }\n}());\n"],"sourceRoot":"/source/"}