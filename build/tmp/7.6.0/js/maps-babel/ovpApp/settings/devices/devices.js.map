{"version":3,"sources":["ovpApp/settings/devices/devices.js"],"names":[],"mappings":"AAAA;;AAAA,CAAC,YAAY;;gIACT;IACA,QAAQ,OAAO,2BAA2B,CACtC,mBACA,8BACA,2BACA,+BAGH,WAAW,qBAAqB;;;IAGjC,SAAS,kBAAkB,QAAQ,YAAY,YACnC,OAAO,QAAQ,mBAAmB,UAAU;;QAEpD,IAAI,KAAK;QACT,GAAG,WAAW;QACd,GAAG,YAAY;QACf,GAAG,WAAW;QACd,GAAG,aAAa;QAChB,GAAG,UAAU;QACb,GAAG,OAAO;QACV,GAAG,SAAS;QACZ,GAAG,eAAe;;QAElB;;;;QAIA,SAAS,WAAW;YAChB,WAAW,UACN,KAAK,UAAU,MAAM;gBAClB,WAAW,gBAAgB,KAAK,UAAA,KAAO;oBACnC,GAAG,OAAO;oBACV,GAAG,aAAa;oBAChB,WAAW,WAAW,sBAAsB,OAAO;;eAEzD,SACK,YAAY;gBACf,GAAG,OAAO;gBACV,GAAG,aAAa;;;YAGxB,IAAI,aAAa,WAAW,IAAI,wBAAwB,UAAU,QAAQ,KAAK;;;;gBAI3E,IAAI,CAAC,QAAQ,OAAO,GAAG,WAAW,MAAM;oBACpC,GAAG,aAAa;;;;YAIxB,OAAO,IAAI,YAAY;;;QAG3B,SAAS,SAAS,KAAK;YACnB,OAAO,GAAG,cAAc,GAAG,WAAW,cAAc,IAAI;;;QAG5D,SAAS,UAAU,KAAK;YACpB,IAAI,CAAC,IAAI,KAAK;gBACV;mBACG;gBACH,IAAI,UAAU,IAAI;gBAClB,IAAI,YAAY;;;;QAIxB,SAAS,aAAa,KAAK;;YAEvB,IAAI,OAAO,IAAI,KAAK,QAAQ,OAAO;;;QAGvC,SAAS,kCAAkC;YACvC,MAAM,KAAK;gBACP,SAAS,kBAAkB,kBAAkB;gBAC7C,YAAY;;;;QAIpB,SAAS,4BAA4B;YACjC,MAAM,KAAK;gBACP,SAAS,SAAS,kBAAkB;gBACpC,YAAY;;;;QAIpB,SAAS,SAAS,KAAK;YACnB,IAAI,CAAC,IAAI,QAAQ,IAAI,KAAK,WAAW,GAAG;gBACpC;mBACG;gBACH,IAAI,IAAI,QAAQ,IAAI,SAAS;oBACzB,WAAW,YAAY,KAAK,IAAI;;;;;;;;;;gBAUpC,IAAI,YAAY;gBAChB,IAAI,UAAU;;;;QAItB,SAAS,WAAW,KAAK;YACrB,IAAI,OAAO,IAAI;YACf,IAAI,YAAY;YAChB,IAAI,UAAU;;;QAGlB,SAAS,QAAQ,KAAK;YAClB,WAAW,cAAc;;;KAIhC","file":"ovpApp/settings/devices/devices.js","sourcesContent":["(function () {\n    'use strict';\n    angular.module('ovpApp.settings.devices', [\n        'ovpApp.messages',\n        'ovpApp.services.stbService',\n        'ovpApp.components.alert',\n        'ovpApp.services.errorCodes'\n        ])\n\n    .controller('DevicesController', DevicesController);\n\n    /* @ngInject */\n    function DevicesController($scope, $rootScope, stbService,\n                alert, $state, errorCodesService, messages) {\n\n        let vm = this;\n        vm.isActive = isActive;\n        vm.beginEdit = beginEdit;\n        vm.saveEdit = saveEdit;\n        vm.cancelEdit = cancelEdit;\n        vm.connect = connect;\n        vm.stbs = [];\n        vm.$state = $state;\n        vm.inputChanged = inputChanged;\n\n        activate();\n\n        /////////////////////\n\n        function activate() {\n            stbService.getSTBs()\n                .then(function (data) {\n                    stbService.getCurrentStb().then(stb => {\n                        vm.stbs = data;\n                        vm.currentStb = stb;\n                        $rootScope.$broadcast('pageChangeComplete', $state.current);\n                    });\n                })\n                .catch(function () {\n                    vm.stbs = [];\n                    vm.currentStb = undefined;\n                });\n\n            let unregister = $rootScope.$on('set-top-box-selected', function ($event, stb) {\n                // If the stb comes from JSON string it may not match.\n                // angular.equals is used to determine if we in fact\n                // have a new object.\n                if (!angular.equals(vm.setTopBox, stb)) {\n                    vm.currentStb = stb;\n                }\n            });\n\n            $scope.$on('$destroy', unregister);\n        }\n\n        function isActive(stb) {\n            return vm.currentStb && vm.currentStb.macAddress == stb.macAddress;\n        }\n\n        function beginEdit(stb) {\n            if (!stb.dvr) {\n                showDoesNotSupportRenameMessage();\n            } else {\n                stb.oldName = stb.name;\n                stb.isEditing = true;\n            }\n        }\n\n        function inputChanged(stb) {\n            // filter out special characters\n            stb.name = stb.name.replace(/\\W/g, '');\n        }\n\n        function showDoesNotSupportRenameMessage() {\n            alert.open({\n                message: errorCodesService.getMessageForCode('WCM-1010'),\n                buttonText: 'OK'\n            });\n        }\n\n        function showNameYourSetTopMessage() {\n            alert.open({\n                message: messages.getMessageForCode('MSG-9099'),\n                buttonText: 'OK'\n            });\n        }\n\n        function saveEdit(stb) {\n            if (!stb.name || stb.name.length === 0) {\n                showNameYourSetTopMessage();\n            } else {\n                if (stb.name != stb.oldName) {\n                    stbService.postStbName(stb, stb.name);\n\n                    // TODO: Analytics Event\n                    // $rootScope.$emit('EG:stbRenamed', {\n                    //     newName: stb.name,\n                    //     oldName: stb.oldName,\n                    //     deviceId: stb.macAddress,\n                    //     isDvr: stb.isDvr\n                    // });\n                }\n                stb.isEditing = false;\n                stb.oldName = undefined;\n            }\n        }\n\n        function cancelEdit(stb) {\n            stb.name = stb.oldName;\n            stb.isEditing = false;\n            stb.oldName = undefined;\n        }\n\n        function connect(stb) {\n            stbService.setCurrentStb(stb);\n        }\n\n    }\n}());\n"],"sourceRoot":"/source/"}