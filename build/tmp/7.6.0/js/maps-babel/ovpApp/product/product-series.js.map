{"version":3,"sources":["ovpApp/product/product-series.js"],"names":[],"mappings":"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","file":"ovpApp/product/product-series.js","sourcesContent":["(function () {\n    'use strict';\n\n    angular.module('ovpApp.product.series', [\n        'ovpApp.config',\n        'ovpApp.directives.carousel',\n        'ovpApp.directives.person',\n        'ovpApp.services.locationService',\n        'ovpApp.directives.affix',\n        'ovpApp.directives.focus',\n        'ovpApp.product.productActionService',\n        'ovpApp.dataDelegate',\n        'ovpApp.messages',\n        'ovpApp.services.parentalControlsService',\n        'ovpApp.services.dateFormat',\n        'ovpApp.product.episodes',\n        'ovpApp.product.focusRestore',\n        'ui.router'\n    ])\n    .component('productSeries', {\n        bindings: {\n            fetcher: '<', // Method for fetching the series. Used if a refresh is needed\n            series: '<',\n            blocked: '<',\n            cameFromWatchLater: '<'\n        },\n        templateUrl: '/js/ovpApp/product/product-series.html',\n        controller: class ProductSeries {\n            constructor($scope, $rootScope, $state, searchService, productService, delegateFactory,\n                productFocusRestore, locationService, $q, $timeout) {\n                angular.extend(this, {$scope, $rootScope, $state, searchService, productService,\n                    delegateFactory, productFocusRestore, locationService, $q, $timeout});\n            }\n\n            $onInit() {\n                this.entitled = this.series.isEntitled !== false;\n                this.deregister = [];\n\n                this.initParentalControls();\n                this.initOoh();\n                this.deregister.push(this.$scope.$on('update-dvr',\n                    (event, schedule, asset, action) => {\n                        this.actionExecuting(asset, action);\n                    }\n                ));\n\n                this.onUpdateData();\n                this.$rootScope.$broadcast('pageChangeComplete', this.$state.current);\n            }\n\n            $onDestroy() {\n                this.deregister.forEach(d => d());\n            }\n\n            onUpdateData() {\n                if (this.series.episodesAvailable <= 0) {\n                    this.activateTab('info', null, 'application');\n                }\n\n                this.$rootScope.$emit('ovp:setPageTitle', this.series.title);\n            }\n\n            initParentalControls() {\n                this.deregister.push(this.$rootScope.$on('ParentalControls:updated',\n                    () => this.updateBlocked()));\n            }\n\n            initOoh() {\n                this.locationService.getLocation().then((location) => {\n                    this.ooh = !location.behindOwnModem;\n                    this.oohUnavailable = this.ooh && !this.series.availableOutOfHome;\n                });\n\n                this.deregister.push(this.$scope.$on('LocationService:locationChanged', (event, location) => {\n                    this.ooh = !location.behindOwnModem;\n                    this.oohUnavailable = this.ooh && !this.series.availableOutOfHome;\n                }));\n            }\n\n            updateBlocked() {\n                this.series.isBlocked.then(isBlocked => this.blocked = isBlocked);\n            }\n\n            isOnTab(tabName) {\n                return this.$state.includes('product.series.' + tabName);\n            }\n\n            actionExecuting(asset, action) {\n                if (this.fetcher) {\n                    const waitForFresh = true;\n                    const promise = this.$q.when(this.fetcher(waitForFresh))\n                        .then(asset => {\n                            this.series = asset;\n                            this.onUpdateData();\n                            // Focus first action after performing action\n                            if (this.series.actions && asset.isSeries) {\n                                this.series.actions[0].focus = true;\n                            }\n                        });\n\n                    this.$scope.$broadcast('product:update-started', asset, action, promise);\n                }\n            }\n\n            availabilityMessage() {\n                return this.productService.availabilityMessage(this.series, this.cameFromWatchLater) || '';\n            }\n\n            activateTab(tab, evt, triggeredBy = 'user') {\n                let activeTab = 'product.series.episodes';\n\n                // Analytics\n                this.$rootScope.$emit('Analytics:select', {\n                    elementStandardizedName: tab,\n                    operationType: 'navigationClick',\n                    triggeredBy: triggeredBy,\n                    pageSectionName: 'navPagePrimary'\n                });\n\n                if (tab === 'episodes' || tab === 'info') {\n                    activeTab = 'product.series.' + tab;\n                }\n\n                if (tab === 'episodes' && (this.series.episodesAvailable <= 0)) {\n                    // set state to 'info' in case\n                    // episodes are not available\n                    activeTab = 'product.series.info';\n                }\n\n                this.$state.go(activeTab, {}, {\n                    location: 'replace'\n                }).then(() => this.$rootScope.$emit('ovp:setPageTitle', this.series.title));\n            }\n\n            getSectionAriaLabel() {\n                return this.series.title + ', ' +\n                    this.series.episodesAvailable + ' episodes' + ', ' +\n                    this.availabilityMessage() + ', ' + this.series.description.long;\n            }\n        }\n    });\n})();\n"],"sourceRoot":"/source/"}